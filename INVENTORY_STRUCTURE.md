# Ù…Ø³ØªÙ†Ø¯Ø§Øª Ù¾ÛŒØ´Ù†Ù‡Ø§Ø¯ÛŒ Ø³Ø§Ø®ØªØ§Ø± Ø§Ù†Ø¨Ø§Ø± Ùˆ Ù…Ø¯ÛŒØ±ÛŒØª Ù…ÙˆØ¬ÙˆØ¯ÛŒ

## ğŸ“‹ Ù†Ù…Ø§ÛŒ Ú©Ù„ÛŒ

Ø§ÛŒÙ† Ø³Ù†Ø¯ØŒ Ø³Ø§Ø®ØªØ§Ø± Ù¾ÛŒØ´Ù†Ù‡Ø§Ø¯ÛŒ Ø¨Ø±Ø§ÛŒ Ù…Ø¯ÛŒØ±ÛŒØª **Ø§Ù†Ø¨Ø§Ø± (Inventory/Storage)** Ø¯Ø± Ú©Ù†Ø§Ø± Ù…Ø§ÛŒÚ©Ø±ÙˆØ³Ø±ÙˆÛŒØ³ Ú©Ø§ØªØ§Ù„ÙˆÚ¯ Ø±Ø§ ØªØ¹Ø±ÛŒÙ Ù…ÛŒâ€ŒÚ©Ù†Ø¯. Ù‡Ø¯Ù Ø§Ø² Ø§ÛŒÙ† Ø³Ù†Ø¯ØŒ Ø§Ø±Ø§Ø¦Ù‡ ÛŒÚ© Ù…Ø¹Ù…Ø§Ø±ÛŒ Ø¬Ø§Ù…Ø¹ Ø¨Ø±Ø§ÛŒ Ù…Ø¯ÛŒØ±ÛŒØª Ù…ÙˆØ¬ÙˆØ¯ÛŒ Ú©Ø§Ù„Ø§ØŒ Ø±Ø²Ø±ÙˆØŒ ØªØ±Ø§Ú©Ù†Ø´â€ŒÙ‡Ø§ÛŒ Ø§Ù†Ø¨Ø§Ø± Ùˆ Ø¬Ù„ÙˆÚ¯ÛŒØ±ÛŒ Ø§Ø² Oversell Ø§Ø³Øª.

> âš ï¸ **ØªÙˆØ¬Ù‡**: ØªÙ…Ø§Ù… Ù…ÙˆØ§Ø±Ø¯ Ø§ÛŒÙ† Ø³Ù†Ø¯ Ù¾ÛŒØ´Ù†Ù‡Ø§Ø¯ÛŒ Ø¨ÙˆØ¯Ù‡ Ùˆ Ù‚Ø¨Ù„ Ø§Ø² Ù¾ÛŒØ§Ø¯Ù‡â€ŒØ³Ø§Ø²ÛŒ Ù†ÛŒØ§Ø² Ø¨Ù‡ Ø¨Ø±Ø±Ø³ÛŒ Ùˆ ØªØ§ÛŒÛŒØ¯ Ø¯Ø§Ø±Ø¯.

---

## ğŸ¯ ØªØ¹Ø±ÛŒÙ Ù†Ù‚Ø´ Ø§Ù†Ø¨Ø§Ø± (Inventory/Storage)

### Ù…Ø³Ø¦ÙˆÙ„ÛŒØªâ€ŒÙ‡Ø§ÛŒ Ø§ØµÙ„ÛŒ Ù…Ø§Ú˜ÙˆÙ„ Ø§Ù†Ø¨Ø§Ø±:

| Ù…Ø³Ø¦ÙˆÙ„ÛŒØª | ØªÙˆØ¶ÛŒØ­Ø§Øª |
|---------|---------|
| **Ù…Ø¯ÛŒØ±ÛŒØª Ù…ÙˆØ¬ÙˆØ¯ÛŒ** | Ù†Ú¯Ù‡Ø¯Ø§Ø±ÛŒ Ùˆ Ø¨Ø±ÙˆØ²Ø±Ø³Ø§Ù†ÛŒ Ù…ÙˆØ¬ÙˆØ¯ÛŒ Ù‡Ø± ØªÙ†ÙˆØ¹ Ù…Ø­ØµÙˆÙ„ (Variant) |
| **Ø±Ø²Ø±Ùˆ Ù…ÙˆØ¬ÙˆØ¯ÛŒ** | Ø±Ø²Ø±Ùˆ Ù…ÙˆÙ‚Øª Ù…ÙˆØ¬ÙˆØ¯ÛŒ Ù‡Ù†Ú¯Ø§Ù… Ø«Ø¨Øª Ø³ÙØ§Ø±Ø´ |
| **ØªØ±Ø§Ú©Ù†Ø´â€ŒÙ‡Ø§ÛŒ Ø§Ù†Ø¨Ø§Ø±** | Ø«Ø¨Øª ØªÙ…Ø§Ù… ÙˆØ±ÙˆØ¯ÛŒâ€ŒÙ‡Ø§ Ùˆ Ø®Ø±ÙˆØ¬ÛŒâ€ŒÙ‡Ø§ÛŒ Ø§Ù†Ø¨Ø§Ø± |
| **Ø¬Ù„ÙˆÚ¯ÛŒØ±ÛŒ Ø§Ø² Oversell** | Ø§Ø·Ù…ÛŒÙ†Ø§Ù† Ø§Ø² ÙØ±ÙˆØ´ ØªÙ†Ù‡Ø§ Ù…Ø­ØµÙˆÙ„Ø§Øª Ù…ÙˆØ¬ÙˆØ¯ |
| **Ù‡Ø´Ø¯Ø§Ø± Ø¢Ø³ØªØ§Ù†Ù‡ Ù…ÙˆØ¬ÙˆØ¯ÛŒ** | Ø§Ø¹Ù„Ø§Ù… Ú©Ù…Ø¨ÙˆØ¯ Ù…ÙˆØ¬ÙˆØ¯ÛŒ Ù‚Ø¨Ù„ Ø§Ø² Ø§ØªÙ…Ø§Ù… |
| **Ú¯Ø²Ø§Ø±Ø´â€ŒÚ¯ÛŒØ±ÛŒ** | ØªØ­Ù„ÛŒÙ„ Ùˆ Ú¯Ø²Ø§Ø±Ø´ ÙˆØ¶Ø¹ÛŒØª Ø§Ù†Ø¨Ø§Ø± |

### Ø±Ø§Ø¨Ø·Ù‡ Ø§Ù†Ø¨Ø§Ø± Ø¨Ø§ Ø³Ø§ÛŒØ± Ù…Ø§Ú˜ÙˆÙ„â€ŒÙ‡Ø§:

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         Catalog Service                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”                            â”‚
â”‚  â”‚ Product â”‚â”€â”€â–¶â”‚ Variant â”‚â—€â”€â”€â”‚ Categoryâ”‚                            â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                            â”‚
â”‚                     â”‚                                                â”‚
â”‚                     â”‚ stock_quantity                                 â”‚
â”‚                     â–¼                                                â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                       Inventory Service                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”‚
â”‚  â”‚  Warehouse    â”‚   â”‚ StockTransaction â”‚   â”‚   Reserve    â”‚         â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â”‚
â”‚          â”‚                    â”‚                    â”‚                 â”‚
â”‚          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                 â”‚
â”‚                               â–¼                                      â”‚
â”‚                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                               â”‚
â”‚                    â”‚   Inventory     â”‚                               â”‚
â”‚                    â”‚  (Ù…ÙˆØ¬ÙˆØ¯ÛŒ Ù„Ø­Ø¸Ù‡â€ŒØ§ÛŒ) â”‚                               â”‚
â”‚                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                               â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                         Order Service                                â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”                          â”‚
â”‚  â”‚  Order  â”‚â”€â”€â–¶â”‚ OrderItem â”‚â—€â”€â”€â”‚  Cart   â”‚                          â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ”„ Ø§Ø±ØªØ¨Ø§Ø· Ù…ÙˆØ¬ÙˆØ¯ÛŒ Ø¨Ø§ Ø³Ø§ÛŒØ± Ù…ÙˆØ¬ÙˆØ¯ÛŒØªâ€ŒÙ‡Ø§

### Ø§Ø±ØªØ¨Ø§Ø· Ø¨Ø§ Variant (ØªÙ†ÙˆØ¹ Ù…Ø­ØµÙˆÙ„)

Ù‡Ø± ØªÙ†ÙˆØ¹ Ù…Ø­ØµÙˆÙ„ (Variant) Ø¯Ø§Ø±Ø§ÛŒ ÙÛŒÙ„Ø¯ `stock_quantity` Ø§Ø³Øª Ú©Ù‡ Ù…ÙˆØ¬ÙˆØ¯ÛŒ Ù„Ø­Ø¸Ù‡â€ŒØ§ÛŒ Ø¢Ù† Ø±Ø§ Ù†Ø´Ø§Ù† Ù…ÛŒâ€ŒØ¯Ù‡Ø¯:

```
Variant
â”œâ”€â”€ id
â”œâ”€â”€ product_id
â”œâ”€â”€ sku
â”œâ”€â”€ price
â”œâ”€â”€ sale_price
â”œâ”€â”€ stock_quantity  â—€â”€â”€ Ù…ÙˆØ¬ÙˆØ¯ÛŒ Ù‚Ø§Ø¨Ù„ ÙØ±ÙˆØ´
â”œâ”€â”€ threshold       â—€â”€â”€ Ø¢Ø³ØªØ§Ù†Ù‡ Ù‡Ø´Ø¯Ø§Ø± Ú©Ù…Ø¨ÙˆØ¯
â””â”€â”€ stock_purchasable
```

### Ø§Ø±ØªØ¨Ø§Ø· Ø¨Ø§ Ù‚ÛŒÙ…Øª

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   Variant   â”‚      â”‚   StockTrans    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤      â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ price       â”‚â—€â”€â”€â”€â”€â–¶â”‚ purchase_price  â”‚ (Ù‚ÛŒÙ…Øª Ø®Ø±ÛŒØ¯)
â”‚ sale_price  â”‚      â”‚ balance         â”‚ (Ù…ÙˆØ¬ÙˆØ¯ÛŒ)
â”‚ stock_qty   â”‚â—€â”€â”€â”€â”€â”€â”‚ amount          â”‚ (ØªØºÛŒÛŒØ±)
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Ø§Ø±ØªØ¨Ø§Ø· Ø¨Ø§ ÙØ±ÙˆØ´ (Order)

```
Order Created
     â”‚
     â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Reserve Stock  â”‚ â—€â”€â”€ Ø±Ø²Ø±Ùˆ Ù…ÙˆØ¬ÙˆØ¯ÛŒ Ø¨Ø±Ø§ÛŒ Ø³ÙØ§Ø±Ø´
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â–¼
   Order Completed?
    /          \
   Yes          No
   /              \
  â–¼                â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Withdraw â”‚   â”‚ Release      â”‚
â”‚ Stock    â”‚   â”‚ Reserve      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ“Š Ù…Ø¯Ù„â€ŒÙ‡Ø§ÛŒ Ø¯Ø§Ù…ÛŒÙ† Ø§Ù†Ø¨Ø§Ø±

### Warehouse (Ø§Ù†Ø¨Ø§Ø±)

```go
// Warehouse Ù†Ù…Ø§ÛŒØ§Ù†Ú¯Ø± ÛŒÚ© Ø§Ù†Ø¨Ø§Ø± ÙÛŒØ²ÛŒÚ©ÛŒ ÛŒØ§ Ù…Ø¬Ø§Ø²ÛŒ Ø§Ø³Øª
type Warehouse struct {
    ID          int64     `json:"id" db:"id"`
    Name        string    `json:"name" db:"name"`
    Code        string    `json:"code" db:"code"`
    Address     *string   `json:"address" db:"address"`
    IsDefault   bool      `json:"is_default" db:"is_default"`
    IsActive    bool      `json:"is_active" db:"is_active"`
    CreatedAt   time.Time `json:"created_at" db:"created_at"`
    UpdatedAt   time.Time `json:"updated_at" db:"updated_at"`
    DeletedAt   *time.Time `json:"deleted_at" db:"deleted_at"`
}
```

### Unit (ÙˆØ§Ø­Ø¯ Ø§Ù†Ø¯Ø§Ø²Ù‡â€ŒÚ¯ÛŒØ±ÛŒ)

```go
// Unit ÙˆØ§Ø­Ø¯ Ø§Ù†Ø¯Ø§Ø²Ù‡â€ŒÚ¯ÛŒØ±ÛŒ Ù…ÙˆØ¬ÙˆØ¯ÛŒ
type Unit struct {
    ID        int64           `json:"id" db:"id"`
    Name      string          `json:"name" db:"name"`      // Ø¹Ø¯Ø¯ØŒ Ú©ÛŒÙ„ÙˆÚ¯Ø±Ù…ØŒ Ù…ØªØ±
    Symbol    string          `json:"symbol" db:"symbol"`  // pcs, kg, m
    Type      int             `json:"type" db:"type"`      // 1=Ø´Ù…Ø§Ø±Ø´ÛŒ, 2=ÙˆØ²Ù†ÛŒ, 3=Ø·ÙˆÙ„ÛŒ
    StepUnit  *float64        `json:"step_unit" db:"step_unit"`   // Ú¯Ø§Ù… Ø§ÙØ²Ø§ÛŒØ´
    MinValue  *float64        `json:"min" db:"min"`
    SubUnit   json.RawMessage `json:"sub_unit" db:"sub_unit"`     // ÙˆØ§Ø­Ø¯ ÙØ±Ø¹ÛŒ (Ú¯Ø±Ù… Ø¨Ø±Ø§ÛŒ Ú©ÛŒÙ„Ùˆ)
    CreatedAt time.Time       `json:"created_at" db:"created_at"`
    UpdatedAt time.Time       `json:"updated_at" db:"updated_at"`
}

// Ø§Ù†ÙˆØ§Ø¹ ÙˆØ§Ø­Ø¯
const (
    UnitTypeCountable  = 1  // Ø´Ù…Ø§Ø±Ø´ÛŒ (Ø¹Ø¯Ø¯)
    UnitTypeWeightable = 2  // ÙˆØ²Ù†ÛŒ (Ú©ÛŒÙ„ÙˆÚ¯Ø±Ù…)
    UnitTypeMeasurable = 3  // Ø·ÙˆÙ„ÛŒ (Ù…ØªØ±)
)
```

### Inventory (Ù…ÙˆØ¬ÙˆØ¯ÛŒ Ù„Ø­Ø¸Ù‡â€ŒØ§ÛŒ)

```go
// Inventory Ù…ÙˆØ¬ÙˆØ¯ÛŒ Ù„Ø­Ø¸Ù‡â€ŒØ§ÛŒ Ù‡Ø± ØªÙ†ÙˆØ¹ Ø¯Ø± Ù‡Ø± Ø§Ù†Ø¨Ø§Ø±
type Inventory struct {
    ID              int64     `json:"id" db:"id"`
    WarehouseID     int64     `json:"warehouse_id" db:"warehouse_id"`
    VariantID       int64     `json:"variant_id" db:"variant_id"`
    UnitID          *int64    `json:"unit_id" db:"unit_id"`
    
    // Ù…ÙˆØ¬ÙˆØ¯ÛŒâ€ŒÙ‡Ø§
    Quantity        float64   `json:"quantity" db:"quantity"`           // Ù…ÙˆØ¬ÙˆØ¯ÛŒ Ú©Ù„
    ReservedQty     float64   `json:"reserved_qty" db:"reserved_qty"`   // Ù…ÙˆØ¬ÙˆØ¯ÛŒ Ø±Ø²Ø±Ùˆ Ø´Ø¯Ù‡
    AvailableQty    float64   `json:"available_qty" db:"available_qty"` // Ù…ÙˆØ¬ÙˆØ¯ÛŒ Ù‚Ø§Ø¨Ù„ ÙØ±ÙˆØ´
    
    // Ø¢Ø³ØªØ§Ù†Ù‡â€ŒÙ‡Ø§
    MinThreshold    *float64  `json:"min_threshold" db:"min_threshold"` // Ø­Ø¯Ø§Ù‚Ù„ Ù…ÙˆØ¬ÙˆØ¯ÛŒ
    MaxThreshold    *float64  `json:"max_threshold" db:"max_threshold"` // Ø­Ø¯Ø§Ú©Ø«Ø± Ù…ÙˆØ¬ÙˆØ¯ÛŒ
    ReorderPoint    *float64  `json:"reorder_point" db:"reorder_point"` // Ù†Ù‚Ø·Ù‡ Ø³ÙØ§Ø±Ø´ Ù…Ø¬Ø¯Ø¯
    
    // Ù‚ÛŒÙ…Øªâ€ŒÙ‡Ø§
    AverageCost     *int64    `json:"average_cost" db:"average_cost"`   // Ù…ÛŒØ§Ù†Ú¯ÛŒÙ† Ù‚ÛŒÙ…Øª Ø®Ø±ÛŒØ¯
    LastCost        *int64    `json:"last_cost" db:"last_cost"`         // Ø¢Ø®Ø±ÛŒÙ† Ù‚ÛŒÙ…Øª Ø®Ø±ÛŒØ¯
    
    LastUpdated     time.Time `json:"last_updated" db:"last_updated"`
    CreatedAt       time.Time `json:"created_at" db:"created_at"`
    UpdatedAt       time.Time `json:"updated_at" db:"updated_at"`
    
    // Relations
    Warehouse *Warehouse `json:"warehouse,omitempty"`
    Variant   *Variant   `json:"variant,omitempty"`
    Unit      *Unit      `json:"unit,omitempty"`
}

// Ù…Ø­Ø§Ø³Ø¨Ù‡ Ù…ÙˆØ¬ÙˆØ¯ÛŒ Ù‚Ø§Ø¨Ù„ ÙØ±ÙˆØ´
func (i *Inventory) CalculateAvailable() float64 {
    return i.Quantity - i.ReservedQty
}

// Ø¨Ø±Ø±Ø³ÛŒ Ù†ÛŒØ§Ø² Ø¨Ù‡ Ø³ÙØ§Ø±Ø´ Ù…Ø¬Ø¯Ø¯
func (i *Inventory) NeedsReorder() bool {
    if i.ReorderPoint == nil {
        return false
    }
    return i.AvailableQty <= *i.ReorderPoint
}
```

### StockTransaction (ØªØ±Ø§Ú©Ù†Ø´ Ø§Ù†Ø¨Ø§Ø±)

```go
// StockTransaction Ø«Ø¨Øª Ù‡Ø± ØªØºÛŒÛŒØ± Ø¯Ø± Ù…ÙˆØ¬ÙˆØ¯ÛŒ
type StockTransaction struct {
    ID             int64           `json:"id" db:"id"`
    WarehouseID    int64           `json:"warehouse_id" db:"warehouse_id"`
    VariantID      int64           `json:"variant_id" db:"variant_id"`
    UnitID         *int64          `json:"unit_id" db:"unit_id"`
    
    // Ù†ÙˆØ¹ Ùˆ Ù…Ù‚Ø§Ø¯ÛŒØ±
    Type           TransactionType `json:"type" db:"type"`
    Amount         float64         `json:"amount" db:"amount"`           // Ù…Ù‚Ø¯Ø§Ø± ØªØºÛŒÛŒØ± (+/-)
    Balance        float64         `json:"balance" db:"balance"`         // Ù…ÙˆØ¬ÙˆØ¯ÛŒ Ø¨Ø¹Ø¯ Ø§Ø² ØªØ±Ø§Ú©Ù†Ø´
    ReservedAmount float64         `json:"reserved_amount" db:"reserved_amount"` // Ù…Ù‚Ø¯Ø§Ø± Ø±Ø²Ø±Ùˆ
    
    // Ù‚ÛŒÙ…Øªâ€ŒÙ‡Ø§
    UnitPrice      *int64          `json:"unit_price" db:"unit_price"`   // Ù‚ÛŒÙ…Øª ÙˆØ§Ø­Ø¯
    TotalPrice     *int64          `json:"total_price" db:"total_price"` // Ù‚ÛŒÙ…Øª Ú©Ù„
    
    // Ø§Ø±Ø¬Ø§Ø¹Ø§Øª
    OrderItemID    *int64          `json:"order_item_id" db:"order_item_id"`
    ReferenceType  *string         `json:"reference_type" db:"reference_type"` // order, purchase, adjustment
    ReferenceID    *int64          `json:"reference_id" db:"reference_id"`
    
    // Ø§Ø·Ù„Ø§Ø¹Ø§Øª Ø§Ù¾Ø±Ø§ØªÙˆØ±
    OperatorID     int64           `json:"operator_id" db:"operator_id"`
    VendorID       *int64          `json:"vendor_id" db:"vendor_id"`     // ÙØ±ÙˆØ´Ù†Ø¯Ù‡/ØªØ§Ù…ÛŒÙ†â€ŒÚ©Ù†Ù†Ø¯Ù‡
    
    // Ø³Ø§ÛŒØ±
    Date           time.Time       `json:"date" db:"date"`
    Note           *string         `json:"note" db:"note"`
    Status         int             `json:"status" db:"status"`
    
    CreatedAt      time.Time       `json:"created_at" db:"created_at"`
    UpdatedAt      time.Time       `json:"updated_at" db:"updated_at"`
    DeletedAt      *time.Time      `json:"deleted_at" db:"deleted_at"`
    
    // Relations
    Warehouse *Warehouse `json:"warehouse,omitempty"`
    Variant   *Variant   `json:"variant,omitempty"`
    Operator  *User      `json:"operator,omitempty"`
}

// Ø§Ù†ÙˆØ§Ø¹ ØªØ±Ø§Ú©Ù†Ø´
type TransactionType string

const (
    TransactionTypeAdd        TransactionType = "add"        // ÙˆØ±ÙˆØ¯ Ø¨Ù‡ Ø§Ù†Ø¨Ø§Ø±
    TransactionTypeSale       TransactionType = "sale"       // ÙØ±ÙˆØ´
    TransactionTypeReserve    TransactionType = "reserve"    // Ø±Ø²Ø±Ùˆ
    TransactionTypeRelease    TransactionType = "release"    // Ø¢Ø²Ø§Ø¯Ø³Ø§Ø²ÛŒ Ø±Ø²Ø±Ùˆ
    TransactionTypeRefund     TransactionType = "refund"     // Ø¨Ø±Ú¯Ø´Øª Ø§Ø² ÙØ±ÙˆØ´
    TransactionTypeAdjustment TransactionType = "adjustment" // ØªØ¹Ø¯ÛŒÙ„ Ù…ÙˆØ¬ÙˆØ¯ÛŒ
    TransactionTypeTransfer   TransactionType = "transfer"   // Ø§Ù†ØªÙ‚Ø§Ù„ Ø¨ÛŒÙ† Ø§Ù†Ø¨Ø§Ø±
    TransactionTypeDamage     TransactionType = "damage"     // Ø¶Ø§ÛŒØ¹Ø§Øª
    TransactionTypeExpiry     TransactionType = "expiry"     // Ø§Ù†Ù‚Ø¶Ø§
)

// ÙˆØ¶Ø¹ÛŒØª ØªØ±Ø§Ú©Ù†Ø´
const (
    TransactionStatusPending   = 0
    TransactionStatusCompleted = 1
    TransactionStatusCancelled = 2
)
```

### StockReservation (Ø±Ø²Ø±Ùˆ Ù…ÙˆØ¬ÙˆØ¯ÛŒ)

```go
// StockReservation Ø±Ø²Ø±Ùˆ Ù…ÙˆÙ‚Øª Ù…ÙˆØ¬ÙˆØ¯ÛŒ Ø¨Ø±Ø§ÛŒ Ø³ÙØ§Ø±Ø´
type StockReservation struct {
    ID          int64     `json:"id" db:"id"`
    WarehouseID int64     `json:"warehouse_id" db:"warehouse_id"`
    VariantID   int64     `json:"variant_id" db:"variant_id"`
    OrderID     int64     `json:"order_id" db:"order_id"`
    OrderItemID int64     `json:"order_item_id" db:"order_item_id"`
    
    Quantity    float64   `json:"quantity" db:"quantity"`
    Status      int       `json:"status" db:"status"`
    
    ExpiresAt   time.Time `json:"expires_at" db:"expires_at"`   // Ø²Ù…Ø§Ù† Ø§Ù†Ù‚Ø¶Ø§ÛŒ Ø±Ø²Ø±Ùˆ
    ReleasedAt  *time.Time `json:"released_at" db:"released_at"`
    ConfirmedAt *time.Time `json:"confirmed_at" db:"confirmed_at"`
    
    CreatedAt   time.Time `json:"created_at" db:"created_at"`
    UpdatedAt   time.Time `json:"updated_at" db:"updated_at"`
}

// ÙˆØ¶Ø¹ÛŒØª Ø±Ø²Ø±Ùˆ
const (
    ReservationStatusPending   = 0  // Ø¯Ø± Ø§Ù†ØªØ¸Ø§Ø±
    ReservationStatusConfirmed = 1  // ØªØ§ÛŒÛŒØ¯ Ø´Ø¯Ù‡
    ReservationStatusReleased  = 2  // Ø¢Ø²Ø§Ø¯ Ø´Ø¯Ù‡
    ReservationStatusExpired   = 3  // Ù…Ù†Ù‚Ø¶ÛŒ Ø´Ø¯Ù‡
)
```

### InventoryLog (Ù„Ø§Ú¯ ØªØºÛŒÛŒØ±Ø§Øª)

```go
// InventoryLog Ù„Ø§Ú¯ Ú©Ø§Ù…Ù„ ØªØºÛŒÛŒØ±Ø§Øª Ù…ÙˆØ¬ÙˆØ¯ÛŒ
type InventoryLog struct {
    ID            int64           `json:"id" db:"id"`
    InventoryID   int64           `json:"inventory_id" db:"inventory_id"`
    VariantID     int64           `json:"variant_id" db:"variant_id"`
    
    Action        string          `json:"action" db:"action"`        // create, update, delete
    Field         string          `json:"field" db:"field"`          // ÙÛŒÙ„Ø¯ ØªØºÛŒÛŒØ± ÛŒØ§ÙØªÙ‡
    OldValue      json.RawMessage `json:"old_value" db:"old_value"`
    NewValue      json.RawMessage `json:"new_value" db:"new_value"`
    
    UserID        int64           `json:"user_id" db:"user_id"`
    IPAddress     *string         `json:"ip_address" db:"ip_address"`
    UserAgent     *string         `json:"user_agent" db:"user_agent"`
    
    CreatedAt     time.Time       `json:"created_at" db:"created_at"`
}
```

### QuantityAction (Ø¹Ù…Ù„ÛŒØ§Øª ØªØºÛŒÛŒØ± Ù…ÙˆØ¬ÙˆØ¯ÛŒ Ú¯Ø±ÙˆÙ‡ÛŒ)

```go
// QuantityAction Ø¹Ù…Ù„ÛŒØ§Øª ØªØºÛŒÛŒØ± Ù…ÙˆØ¬ÙˆØ¯ÛŒ Ø¯Ø³ØªÙ‡â€ŒØ§ÛŒ
type QuantityAction struct {
    ID            int64           `json:"id" db:"id"`
    Request       json.RawMessage `json:"request" db:"request"`       // Ø´Ø±Ø§ÛŒØ· Ø§Ù†ØªØ®Ø§Ø¨ Ù…Ø­ØµÙˆÙ„Ø§Øª
    Operation     string          `json:"operation" db:"operation"`   // add, subtract, set
    Amount        float64         `json:"amount" db:"amount"`
    TotalVariants int             `json:"total_variants" db:"total_variants"`
    Status        int             `json:"status" db:"status"`
    CreatedBy     int64           `json:"created_by" db:"created_by"`
    CreatedAt     time.Time       `json:"created_at" db:"created_at"`
    UpdatedAt     time.Time       `json:"updated_at" db:"updated_at"`
    DeletedAt     *time.Time      `json:"deleted_at" db:"deleted_at"`
    
    // Relations
    Histories []QuantityHistory `json:"histories,omitempty"`
}

// Ø¹Ù…Ù„ÛŒØ§Øªâ€ŒÙ‡Ø§ÛŒ Ù…Ø¬Ø§Ø²
const (
    QuantityOperationAdd      = "add"
    QuantityOperationSubtract = "subtract"
    QuantityOperationSet      = "set"
)
```

### QuantityHistory (ØªØ§Ø±ÛŒØ®Ú†Ù‡ ØªØºÛŒÛŒØ±Ø§Øª Ù…ÙˆØ¬ÙˆØ¯ÛŒ)

```go
// QuantityHistory ØªØ§Ø±ÛŒØ®Ú†Ù‡ ØªØºÛŒÛŒØ±Ø§Øª Ù…ÙˆØ¬ÙˆØ¯ÛŒ ÛŒÚ© ÙˆØ§Ø±ÛŒØ§Ù†Øª
type QuantityHistory struct {
    ID               int64     `json:"id" db:"id"`
    QuantityActionID int64     `json:"quantity_action_id" db:"quantity_action_id"`
    VariantID        int64     `json:"variant_id" db:"variant_id"`
    ProductID        int64     `json:"product_id" db:"product_id"`
    
    OldQuantity      float64   `json:"old_quantity" db:"old_quantity"`
    NewQuantity      float64   `json:"new_quantity" db:"new_quantity"`
    ChangeAmount     float64   `json:"change_amount" db:"change_amount"`
    
    CreatedAt        time.Time `json:"created_at" db:"created_at"`
}
```

---

## ğŸ“ Ø³Ø§Ø®ØªØ§Ø± Ù¾ÙˆØ´Ù‡â€ŒÙ‡Ø§ Ùˆ ÙØ§ÛŒÙ„â€ŒÙ‡Ø§

### Ù¾ÛŒØ´Ù†Ù‡Ø§Ø¯ Û±: Ù…Ø§Ú˜ÙˆÙ„ Ø§Ù†Ø¨Ø§Ø± Ø¯Ø± Ú©Ù†Ø§Ø± Ú©Ø§ØªØ§Ù„ÙˆÚ¯ (Monorepo)

```
go-catalog/
â”œâ”€â”€ internal/
â”‚   â”œâ”€â”€ domain/
â”‚   â”‚   â”œâ”€â”€ product.go
â”‚   â”‚   â”œâ”€â”€ variant.go
â”‚   â”‚   â”œâ”€â”€ category.go
â”‚   â”‚   â”‚
â”‚   â”‚   â””â”€â”€ inventory/              # â—€â”€â”€ Ù…Ø§Ú˜ÙˆÙ„ Ø§Ù†Ø¨Ø§Ø±
â”‚   â”‚       â”œâ”€â”€ warehouse.go
â”‚   â”‚       â”œâ”€â”€ unit.go
â”‚   â”‚       â”œâ”€â”€ inventory.go
â”‚   â”‚       â”œâ”€â”€ stock_transaction.go
â”‚   â”‚       â”œâ”€â”€ stock_reservation.go
â”‚   â”‚       â”œâ”€â”€ inventory_log.go
â”‚   â”‚       â”œâ”€â”€ quantity_action.go
â”‚   â”‚       â””â”€â”€ quantity_history.go
â”‚   â”‚
â”‚   â”œâ”€â”€ repository/
â”‚   â”‚   â”œâ”€â”€ product_repo.go
â”‚   â”‚   â”œâ”€â”€ variant_repo.go
â”‚   â”‚   â”‚
â”‚   â”‚   â””â”€â”€ inventory/
â”‚   â”‚       â”œâ”€â”€ interfaces.go
â”‚   â”‚       â”œâ”€â”€ warehouse_repo.go
â”‚   â”‚       â”œâ”€â”€ inventory_repo.go
â”‚   â”‚       â”œâ”€â”€ transaction_repo.go
â”‚   â”‚       â””â”€â”€ reservation_repo.go
â”‚   â”‚
â”‚   â”œâ”€â”€ service/
â”‚   â”‚   â”œâ”€â”€ product_service.go
â”‚   â”‚   â”‚
â”‚   â”‚   â””â”€â”€ inventory/
â”‚   â”‚       â”œâ”€â”€ inventory_service.go
â”‚   â”‚       â”œâ”€â”€ stock_service.go
â”‚   â”‚       â”œâ”€â”€ reservation_service.go
â”‚   â”‚       â””â”€â”€ report_service.go
â”‚   â”‚
â”‚   â”œâ”€â”€ http/
â”‚   â”‚   â”œâ”€â”€ handlers/
â”‚   â”‚   â”‚   â”œâ”€â”€ product_handler.go
â”‚   â”‚   â”‚   â”‚
â”‚   â”‚   â”‚   â””â”€â”€ inventory/
â”‚   â”‚   â”‚       â”œâ”€â”€ warehouse_handler.go
â”‚   â”‚   â”‚       â”œâ”€â”€ inventory_handler.go
â”‚   â”‚   â”‚       â”œâ”€â”€ transaction_handler.go
â”‚   â”‚   â”‚       â””â”€â”€ report_handler.go
â”‚   â”‚   â”‚
â”‚   â”‚   â””â”€â”€ routes.go
â”‚   â”‚
â”‚   â””â”€â”€ events/
â”‚       â”œâ”€â”€ stock_events.go
â”‚       â””â”€â”€ handlers/
â”‚           â”œâ”€â”€ order_created_handler.go
â”‚           â”œâ”€â”€ order_completed_handler.go
â”‚           â””â”€â”€ order_cancelled_handler.go
```

### Ù¾ÛŒØ´Ù†Ù‡Ø§Ø¯ Û²: Ù…Ø§ÛŒÚ©Ø±ÙˆØ³Ø±ÙˆÛŒØ³ Ù…Ø³ØªÙ‚Ù„ (go-inventory)

```
go-inventory/
â”œâ”€â”€ cmd/
â”‚   â””â”€â”€ server/
â”‚       â””â”€â”€ main.go
â”‚
â”œâ”€â”€ internal/
â”‚   â”œâ”€â”€ app/
â”‚   â”‚   â””â”€â”€ app.go
â”‚   â”‚
â”‚   â”œâ”€â”€ config/
â”‚   â”‚   â””â”€â”€ config.go
â”‚   â”‚
â”‚   â”œâ”€â”€ domain/
â”‚   â”‚   â”œâ”€â”€ warehouse.go
â”‚   â”‚   â”œâ”€â”€ unit.go
â”‚   â”‚   â”œâ”€â”€ inventory.go
â”‚   â”‚   â”œâ”€â”€ stock_transaction.go
â”‚   â”‚   â”œâ”€â”€ stock_reservation.go
â”‚   â”‚   â””â”€â”€ quantity_action.go
â”‚   â”‚
â”‚   â”œâ”€â”€ repository/
â”‚   â”‚   â”œâ”€â”€ interfaces.go
â”‚   â”‚   â”œâ”€â”€ warehouse_repo.go
â”‚   â”‚   â”œâ”€â”€ inventory_repo.go
â”‚   â”‚   â”œâ”€â”€ transaction_repo.go
â”‚   â”‚   â””â”€â”€ reservation_repo.go
â”‚   â”‚
â”‚   â”œâ”€â”€ service/
â”‚   â”‚   â”œâ”€â”€ inventory_service.go
â”‚   â”‚   â”œâ”€â”€ stock_service.go
â”‚   â”‚   â”œâ”€â”€ reservation_service.go
â”‚   â”‚   â””â”€â”€ sync_service.go         # â—€â”€â”€ Ù‡Ù…Ú¯Ø§Ù…â€ŒØ³Ø§Ø²ÛŒ Ø¨Ø§ Ú©Ø§ØªØ§Ù„ÙˆÚ¯
â”‚   â”‚
â”‚   â”œâ”€â”€ http/
â”‚   â”‚   â”œâ”€â”€ handlers/
â”‚   â”‚   â”‚   â”œâ”€â”€ warehouse_handler.go
â”‚   â”‚   â”‚   â”œâ”€â”€ inventory_handler.go
â”‚   â”‚   â”‚   â”œâ”€â”€ transaction_handler.go
â”‚   â”‚   â”‚   â””â”€â”€ health_handler.go
â”‚   â”‚   â”‚
â”‚   â”‚   â”œâ”€â”€ middlewares/
â”‚   â”‚   â”‚   â””â”€â”€ auth.go
â”‚   â”‚   â”‚
â”‚   â”‚   â””â”€â”€ routes.go
â”‚   â”‚
â”‚   â”œâ”€â”€ grpc/                       # â—€â”€â”€ Ø§Ø±ØªØ¨Ø§Ø· RPC Ø¨Ø§ Ø³Ø§ÛŒØ± Ø³Ø±ÙˆÛŒØ³â€ŒÙ‡Ø§
â”‚   â”‚   â”œâ”€â”€ server.go
â”‚   â”‚   â””â”€â”€ handlers/
â”‚   â”‚       â””â”€â”€ inventory_handler.go
â”‚   â”‚
â”‚   â”œâ”€â”€ events/                     # â—€â”€â”€ Event-Driven
â”‚   â”‚   â”œâ”€â”€ publisher.go
â”‚   â”‚   â”œâ”€â”€ consumer.go
â”‚   â”‚   â””â”€â”€ handlers/
â”‚   â”‚       â”œâ”€â”€ order_events.go
â”‚   â”‚       â””â”€â”€ catalog_events.go
â”‚   â”‚
â”‚   â””â”€â”€ pkg/
â”‚       â”œâ”€â”€ logger/
â”‚       â”œâ”€â”€ errors/
â”‚       â””â”€â”€ utils/
â”‚
â”œâ”€â”€ proto/
â”‚   â””â”€â”€ inventory.proto             # â—€â”€â”€ ØªØ¹Ø±ÛŒÙ gRPC
â”‚
â”œâ”€â”€ database/
â”‚   â””â”€â”€ migrations/
â”‚
â”œâ”€â”€ go.mod
â”œâ”€â”€ go.sum
â”œâ”€â”€ Dockerfile
â””â”€â”€ README.md
```

---

## ğŸ”Œ API Ù‡Ø§ÛŒ Ù¾Ø§ÛŒÙ‡â€ŒØ§ÛŒ Ù…Ø¯ÛŒØ±ÛŒØª Ù…ÙˆØ¬ÙˆØ¯ÛŒ

### Inventory APIs

| Method | Endpoint | ØªÙˆØ¶ÛŒØ­Ø§Øª |
|--------|----------|---------|
| `GET` | `/api/inventory` | Ù„ÛŒØ³Øª Ù…ÙˆØ¬ÙˆØ¯ÛŒâ€ŒÙ‡Ø§ |
| `GET` | `/api/inventory/:variant_id` | Ù…ÙˆØ¬ÙˆØ¯ÛŒ ÛŒÚ© ØªÙ†ÙˆØ¹ |
| `PUT` | `/api/inventory/:variant_id` | Ø¨Ø±ÙˆØ²Ø±Ø³Ø§Ù†ÛŒ Ù…ÙˆØ¬ÙˆØ¯ÛŒ |
| `POST` | `/api/inventory/adjust` | ØªØ¹Ø¯ÛŒÙ„ Ù…ÙˆØ¬ÙˆØ¯ÛŒ |
| `POST` | `/api/inventory/bulk-update` | Ø¨Ø±ÙˆØ²Ø±Ø³Ø§Ù†ÛŒ Ú¯Ø±ÙˆÙ‡ÛŒ |

### Stock Transaction APIs

| Method | Endpoint | ØªÙˆØ¶ÛŒØ­Ø§Øª |
|--------|----------|---------|
| `GET` | `/api/transactions` | Ù„ÛŒØ³Øª ØªØ±Ø§Ú©Ù†Ø´â€ŒÙ‡Ø§ |
| `GET` | `/api/transactions/:id` | Ø¬Ø²Ø¦ÛŒØ§Øª ØªØ±Ø§Ú©Ù†Ø´ |
| `POST` | `/api/transactions/add` | ÙˆØ±ÙˆØ¯ Ø¨Ù‡ Ø§Ù†Ø¨Ø§Ø± |
| `POST` | `/api/transactions/withdraw` | Ø®Ø±ÙˆØ¬ Ø§Ø² Ø§Ù†Ø¨Ø§Ø± |
| `POST` | `/api/transactions/transfer` | Ø§Ù†ØªÙ‚Ø§Ù„ Ø¨ÛŒÙ† Ø§Ù†Ø¨Ø§Ø± |

### Reservation APIs

| Method | Endpoint | ØªÙˆØ¶ÛŒØ­Ø§Øª |
|--------|----------|---------|
| `POST` | `/api/reservations/reserve` | Ø±Ø²Ø±Ùˆ Ù…ÙˆØ¬ÙˆØ¯ÛŒ |
| `POST` | `/api/reservations/release` | Ø¢Ø²Ø§Ø¯Ø³Ø§Ø²ÛŒ Ø±Ø²Ø±Ùˆ |
| `POST` | `/api/reservations/confirm` | ØªØ§ÛŒÛŒØ¯ Ùˆ Ú©Ø³Ø± Ø§Ø² Ù…ÙˆØ¬ÙˆØ¯ÛŒ |
| `GET` | `/api/reservations/order/:order_id` | Ø±Ø²Ø±ÙˆÙ‡Ø§ÛŒ ÛŒÚ© Ø³ÙØ§Ø±Ø´ |

### Warehouse APIs

| Method | Endpoint | ØªÙˆØ¶ÛŒØ­Ø§Øª |
|--------|----------|---------|
| `GET` | `/api/warehouses` | Ù„ÛŒØ³Øª Ø§Ù†Ø¨Ø§Ø±Ù‡Ø§ |
| `POST` | `/api/warehouses` | Ø§ÛŒØ¬Ø§Ø¯ Ø§Ù†Ø¨Ø§Ø± Ø¬Ø¯ÛŒØ¯ |
| `PUT` | `/api/warehouses/:id` | ÙˆÛŒØ±Ø§ÛŒØ´ Ø§Ù†Ø¨Ø§Ø± |
| `DELETE` | `/api/warehouses/:id` | Ø­Ø°Ù Ø§Ù†Ø¨Ø§Ø± |

### Report APIs

| Method | Endpoint | ØªÙˆØ¶ÛŒØ­Ø§Øª |
|--------|----------|---------|
| `GET` | `/api/reports/stock-levels` | Ú¯Ø²Ø§Ø±Ø´ Ø³Ø·Ø­ Ù…ÙˆØ¬ÙˆØ¯ÛŒ |
| `GET` | `/api/reports/low-stock` | Ú©Ø§Ù„Ø§Ù‡Ø§ÛŒ Ú©Ù…â€ŒÙ…ÙˆØ¬ÙˆØ¯ |
| `GET` | `/api/reports/movements` | Ú¯Ø²Ø§Ø±Ø´ Ú¯Ø±Ø¯Ø´ Ø§Ù†Ø¨Ø§Ø± |
| `GET` | `/api/reports/valuation` | Ø§Ø±Ø²Ø´â€ŒÚ¯Ø°Ø§Ø±ÛŒ Ø§Ù†Ø¨Ø§Ø± |

---

## ğŸ“¥ Ù†Ù…ÙˆÙ†Ù‡ Request/Response

### POST /api/transactions/add

**Request:**
```json
{
  "warehouse_id": 1,
  "variant_id": 123,
  "amount": 50,
  "unit_price": 150000,
  "vendor_id": 5,
  "note": "Ø®Ø±ÛŒØ¯ Ø§Ø² ØªØ§Ù…ÛŒÙ†â€ŒÚ©Ù†Ù†Ø¯Ù‡ Ø§Ù„Ù",
  "date": "2025-01-15"
}
```

**Response:**
```json
{
  "success": true,
  "transaction": {
    "id": 456,
    "warehouse_id": 1,
    "variant_id": 123,
    "type": "add",
    "amount": 50,
    "balance": 150,
    "unit_price": 150000,
    "total_price": 7500000,
    "created_at": "2025-01-15T10:30:00Z"
  },
  "inventory": {
    "variant_id": 123,
    "quantity": 150,
    "available_qty": 145,
    "reserved_qty": 5
  }
}
```

### POST /api/reservations/reserve

**Request:**
```json
{
  "order_id": 789,
  "items": [
    {
      "variant_id": 123,
      "quantity": 2
    },
    {
      "variant_id": 124,
      "quantity": 1
    }
  ],
  "expires_in_minutes": 30
}
```

**Response:**
```json
{
  "success": true,
  "reservations": [
    {
      "id": 1001,
      "variant_id": 123,
      "quantity": 2,
      "status": "pending",
      "expires_at": "2025-01-15T11:00:00Z"
    },
    {
      "id": 1002,
      "variant_id": 124,
      "quantity": 1,
      "status": "pending",
      "expires_at": "2025-01-15T11:00:00Z"
    }
  ]
}
```

---

## ğŸ”„ Ø¬Ø±ÛŒØ§Ù† Ø¯Ø§Ø¯Ù‡

### Û±. ÙˆØ±ÙˆØ¯ Ø¨Ù‡ Ø§Ù†Ø¨Ø§Ø± (Stock In)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  API Call   â”‚â”€â”€â”€â”€â–¶â”‚ StockService    â”‚â”€â”€â”€â”€â–¶â”‚ TransactionRepo â”‚
â”‚  /add       â”‚     â”‚ .AddStock()     â”‚     â”‚ .Create()       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                             â”‚                       â”‚
                             â–¼                       â–¼
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚ InventoryRepo   â”‚     â”‚ StockTransactionâ”‚
                    â”‚ .UpdateQty()    â”‚     â”‚ (Record)        â”‚
                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                             â”‚
                             â–¼
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚ Publish Event   â”‚
                    â”‚ StockAdded      â”‚
                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                             â”‚
                             â–¼
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚ Catalog Service â”‚
                    â”‚ Update Variant  â”‚
                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Û². Ø±Ø²Ø±Ùˆ Ù…ÙˆØ¬ÙˆØ¯ÛŒ (Order Created)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Order Event â”‚â”€â”€â”€â”€â–¶â”‚ Consumer        â”‚
â”‚ Created     â”‚     â”‚ Handler         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                             â”‚
                             â–¼
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚ Check Available â”‚
                    â”‚ Quantity        â”‚
                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                             â”‚
              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
              â”‚                             â”‚
         Available                    Not Available
              â”‚                             â”‚
              â–¼                             â–¼
     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
     â”‚ Create Reserve  â”‚          â”‚ Publish Event   â”‚
     â”‚ Transaction     â”‚          â”‚ OutOfStock      â”‚
     â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
              â”‚
              â–¼
     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
     â”‚ Update Inventoryâ”‚
     â”‚ reserved_qty++  â”‚
     â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
              â”‚
              â–¼
     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
     â”‚ Publish Event   â”‚
     â”‚ StockReserved   â”‚
     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Û³. ØªÚ©Ù…ÛŒÙ„ Ø³ÙØ§Ø±Ø´ (Order Completed)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Order Event â”‚â”€â”€â”€â”€â–¶â”‚ Consumer        â”‚
â”‚ Completed   â”‚     â”‚ Handler         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                             â”‚
                             â–¼
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚ Find Reservationâ”‚
                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                             â”‚
                             â–¼
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚ Confirm Reserve â”‚
                    â”‚ status=confirmedâ”‚
                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                             â”‚
                             â–¼
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚ Create Withdraw â”‚
                    â”‚ Transaction     â”‚
                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                             â”‚
                             â–¼
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚ Update Inventoryâ”‚
                    â”‚ quantity--      â”‚
                    â”‚ reserved_qty--  â”‚
                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                             â”‚
                             â–¼
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚ Sync with       â”‚
                    â”‚ Catalog Service â”‚
                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Û´. Ù„ØºÙˆ Ø³ÙØ§Ø±Ø´ (Order Cancelled)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Order Event â”‚â”€â”€â”€â”€â–¶â”‚ Consumer        â”‚
â”‚ Cancelled   â”‚     â”‚ Handler         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                             â”‚
                             â–¼
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚ Find Reservationâ”‚
                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                             â”‚
                             â–¼
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚ Release Reserve â”‚
                    â”‚ status=released â”‚
                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                             â”‚
                             â–¼
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚ Create Release  â”‚
                    â”‚ Transaction     â”‚
                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                             â”‚
                             â–¼
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚ Update Inventoryâ”‚
                    â”‚ reserved_qty--  â”‚
                    â”‚ available_qty++ â”‚
                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ”— Ø§Ø±ØªØ¨Ø§Ø· Ù…Ø§ÛŒÚ©Ø±ÙˆØ³Ø±ÙˆÛŒØ³ Ø§Ù†Ø¨Ø§Ø± Ø¨Ø§ Ú©Ø§ØªØ§Ù„ÙˆÚ¯

### Ú¯Ø²ÛŒÙ†Ù‡ Û±: Event-Driven (Ù¾ÛŒØ´Ù†Ù‡Ø§Ø¯ÛŒ)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Catalog Service â”‚                    â”‚Inventory Serviceâ”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚                                      â”‚
         â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”‚
         â”œâ”€â–¶â”‚      Message Broker         â”‚â—€â”€â”€â”€â”€â”¤
         â”‚  â”‚   (RabbitMQ / Kafka / NATS) â”‚     â”‚
         â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚
         â”‚                                      â”‚
         â”‚  Events:                             â”‚
         â”‚  â€¢ product.created                   â”‚
         â”‚  â€¢ variant.created                   â”‚
         â”‚  â€¢ stock.updated â—€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
         â”‚  â€¢ order.created                     â”‚
         â”‚  â€¢ order.completed                   â”‚
         â”‚  â€¢ order.cancelled                   â”‚
         â”‚                                      â”‚
         â–¼                                      â–¼
   Update stock_quantity              Process stock changes
```

**Ù…Ø²Ø§ÛŒØ§:**
- Loose coupling
- Scalability
- Async processing
- Fault tolerance

### Ú¯Ø²ÛŒÙ†Ù‡ Û²: Sync REST API

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     HTTP/REST      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Catalog Service â”‚â—€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶â”‚Inventory Serviceâ”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

GET  /inventory/variant/{id}
POST /inventory/reserve
POST /inventory/release
POST /inventory/withdraw
```

### Ú¯Ø²ÛŒÙ†Ù‡ Û³: gRPC (Ø¨Ø±Ø§ÛŒ Ø¹Ù…Ù„ÛŒØ§Øª Real-time)

```protobuf
// inventory.proto
service InventoryService {
    rpc CheckAvailability(CheckRequest) returns (CheckResponse);
    rpc ReserveStock(ReserveRequest) returns (ReserveResponse);
    rpc ReleaseStock(ReleaseRequest) returns (ReleaseResponse);
    rpc GetInventory(GetInventoryRequest) returns (InventoryResponse);
}

message CheckRequest {
    int64 variant_id = 1;
    double quantity = 2;
}

message CheckResponse {
    bool available = 1;
    double available_quantity = 2;
}
```

### Ù¾ÛŒØ´Ù†Ù‡Ø§Ø¯ ØªØ±Ú©ÛŒØ¨ÛŒ:

| Ø¹Ù…Ù„ÛŒØ§Øª | Ø±ÙˆØ´ Ø§Ø±ØªØ¨Ø§Ø· | Ø¯Ù„ÛŒÙ„ |
|--------|-----------|------|
| Ø¨Ø±Ø±Ø³ÛŒ Ù…ÙˆØ¬ÙˆØ¯ÛŒ | gRPC | Ù†ÛŒØ§Ø² Ø¨Ù‡ Ù¾Ø§Ø³Ø® Ø³Ø±ÛŒØ¹ |
| Ø±Ø²Ø±Ùˆ Ù…ÙˆØ¬ÙˆØ¯ÛŒ | gRPC | Ù†ÛŒØ§Ø² Ø¨Ù‡ ØªØ±Ø§Ú©Ù†Ø´ Ù‡Ù…Ø²Ù…Ø§Ù† |
| Ø¨Ø±ÙˆØ²Ø±Ø³Ø§Ù†ÛŒ Ù…ÙˆØ¬ÙˆØ¯ÛŒ Ø¯Ø± Ú©Ø§ØªØ§Ù„ÙˆÚ¯ | Event | asyncØŒ Ø¨Ø¯ÙˆÙ† Ù†ÛŒØ§Ø² Ø¨Ù‡ Ù¾Ø§Ø³Ø® |
| Ú¯Ø²Ø§Ø±Ø´Ø§Øª | REST | Ú©Ø§Ø±Ø¨Ø±Ø¯ ØºÛŒØ±Ø¨Ø­Ø±Ø§Ù†ÛŒ |

---

## ğŸ›¡ï¸ Ù†Ú©Ø§Øª Ù…Ù‡Ù†Ø¯Ø³ÛŒ

### Û±. Ù‡Ù…Ú¯Ø§Ù…â€ŒØ³Ø§Ø²ÛŒ Ø¨Ø§ Ø¯ÛŒØªØ§Ø¨ÛŒØ³ (Sync)

```go
// Ø§Ø³ØªØ±Ø§ØªÚ˜ÛŒ Ù‡Ù…Ú¯Ø§Ù…â€ŒØ³Ø§Ø²ÛŒ
type SyncStrategy interface {
    SyncInventoryToCatalog(ctx context.Context, variantID int64) error
    SyncAllInventories(ctx context.Context) error
}

// Ù¾ÛŒØ§Ø¯Ù‡â€ŒØ³Ø§Ø²ÛŒ Ø¨Ø§ Eventual Consistency
type EventualSyncStrategy struct {
    publisher EventPublisher
}

func (s *EventualSyncStrategy) SyncInventoryToCatalog(ctx context.Context, variantID int64) error {
    inventory, _ := s.repo.GetByVariantID(ctx, variantID)
    
    event := StockUpdatedEvent{
        VariantID:    variantID,
        Quantity:     inventory.Quantity,
        AvailableQty: inventory.AvailableQty,
        UpdatedAt:    time.Now(),
    }
    
    return s.publisher.Publish("stock.updated", event)
}
```

### Û². Ø¬Ù„ÙˆÚ¯ÛŒØ±ÛŒ Ø§Ø² Oversell

```go
// Ø§Ø³ØªÙØ§Ø¯Ù‡ Ø§Ø² Optimistic Locking
type Inventory struct {
    // ...
    Version int `json:"version" db:"version"`
}

func (r *InventoryRepo) ReserveWithLock(ctx context.Context, variantID int64, qty float64) error {
    tx, _ := r.db.BeginTx(ctx, &sql.TxOptions{Isolation: sql.LevelSerializable})
    defer tx.Rollback()
    
    // Ù‚ÙÙ„ Ø±Ø¯ÛŒÙ
    inv, err := r.getForUpdate(tx, variantID)
    if err != nil {
        return err
    }
    
    // Ø¨Ø±Ø±Ø³ÛŒ Ù…ÙˆØ¬ÙˆØ¯ÛŒ
    if inv.AvailableQty < qty {
        return ErrInsufficientStock
    }
    
    // Ø¨Ø±ÙˆØ²Ø±Ø³Ø§Ù†ÛŒ
    inv.ReservedQty += qty
    inv.AvailableQty = inv.Quantity - inv.ReservedQty
    inv.Version++
    
    if err := r.updateWithVersion(tx, inv); err != nil {
        return err
    }
    
    return tx.Commit()
}
```

**Ø±ÙˆØ´â€ŒÙ‡Ø§ÛŒ Ø¬Ù„ÙˆÚ¯ÛŒØ±ÛŒ Ø§Ø² Oversell:**

| Ø±ÙˆØ´ | ØªÙˆØ¶ÛŒØ­Ø§Øª | Ù…Ø²Ø§ÛŒØ§ | Ù…Ø¹Ø§ÛŒØ¨ |
|-----|---------|-------|-------|
| **Pessimistic Lock** | Ù‚ÙÙ„ Ø±Ø¯ÛŒÙ Ø¯Ø± DB | Ø¯Ù‚Øª Ø¨Ø§Ù„Ø§ | Ú©Ù†Ø¯ÛŒØŒ bottleneck |
| **Optimistic Lock** | Ø¨Ø±Ø±Ø³ÛŒ version | Ø³Ø±ÛŒØ¹â€ŒØªØ± | Ù†ÛŒØ§Ø² Ø¨Ù‡ retry |
| **Distributed Lock** | Redis SETNX | Ù…Ù†Ø§Ø³Ø¨ microservice | Ù¾ÛŒÚ†ÛŒØ¯Ú¯ÛŒ |
| **Event Sourcing** | Ø«Ø¨Øª Ù‡Ù…Ù‡ ØªØ±Ø§Ú©Ù†Ø´â€ŒÙ‡Ø§ | audit Ú©Ø§Ù…Ù„ | Ù¾ÛŒÚ†ÛŒØ¯Ú¯ÛŒ Ø¨Ø§Ù„Ø§ |

### Û³. Ø«Ø¨Øª ØªØ±Ø§Ú©Ù†Ø´â€ŒÙ‡Ø§ÛŒ Ø§Ù†Ø¨Ø§Ø±

```go
// Audit Trail Ø¨Ø±Ø§ÛŒ Ù‡Ø± ØªØºÛŒÛŒØ±
type StockAuditService struct {
    logRepo InventoryLogRepository
}

func (s *StockAuditService) LogChange(ctx context.Context, inv *Inventory, action string, userID int64) error {
    log := &InventoryLog{
        InventoryID: inv.ID,
        VariantID:   inv.VariantID,
        Action:      action,
        Field:       "quantity",
        OldValue:    json.RawMessage(`{"quantity": ` + strconv.FormatFloat(inv.OldQuantity, 'f', 2, 64) + `}`),
        NewValue:    json.RawMessage(`{"quantity": ` + strconv.FormatFloat(inv.Quantity, 'f', 2, 64) + `}`),
        UserID:      userID,
        IPAddress:   getIPFromContext(ctx),
        CreatedAt:   time.Now(),
    }
    
    return s.logRepo.Create(ctx, log)
}
```

### Û´. Event-Driven Architecture

```go
// ØªØ¹Ø±ÛŒÙ Event Ù‡Ø§
type StockEvent struct {
    Type      string    `json:"type"`
    VariantID int64     `json:"variant_id"`
    Quantity  float64   `json:"quantity"`
    Timestamp time.Time `json:"timestamp"`
}

const (
    EventStockAdded     = "stock.added"
    EventStockReserved  = "stock.reserved"
    EventStockReleased  = "stock.released"
    EventStockWithdrawn = "stock.withdrawn"
    EventLowStock       = "stock.low"
)

// Publisher
type EventPublisher interface {
    Publish(topic string, event interface{}) error
}

// Consumer Handler
type OrderEventHandler struct {
    stockService StockService
}

func (h *OrderEventHandler) HandleOrderCreated(event OrderCreatedEvent) error {
    for _, item := range event.Items {
        if err := h.stockService.Reserve(context.Background(), ReserveRequest{
            OrderID:   event.OrderID,
            VariantID: item.VariantID,
            Quantity:  item.Quantity,
        }); err != nil {
            return err
        }
    }
    return nil
}
```

### Ûµ. Cache Strategy

```go
// Ú©Ø´ Ù…ÙˆØ¬ÙˆØ¯ÛŒ Ø¨Ø±Ø§ÛŒ Ø®ÙˆØ§Ù†Ø¯Ù† Ø³Ø±ÛŒØ¹
type CachedInventoryRepo struct {
    repo  InventoryRepository
    cache *redis.Client
    ttl   time.Duration
}

func (r *CachedInventoryRepo) GetAvailable(ctx context.Context, variantID int64) (float64, error) {
    key := fmt.Sprintf("inv:available:%d", variantID)
    
    // Try cache
    if val, err := r.cache.Get(ctx, key).Float64(); err == nil {
        return val, nil
    }
    
    // Fallback to DB
    inv, err := r.repo.GetByVariantID(ctx, variantID)
    if err != nil {
        return 0, err
    }
    
    // Update cache
    r.cache.Set(ctx, key, inv.AvailableQty, r.ttl)
    
    return inv.AvailableQty, nil
}

// Invalidate cache on update
func (r *CachedInventoryRepo) Update(ctx context.Context, inv *Inventory) error {
    if err := r.repo.Update(ctx, inv); err != nil {
        return err
    }
    
    key := fmt.Sprintf("inv:available:%d", inv.VariantID)
    r.cache.Del(ctx, key)
    
    return nil
}
```

---

## ğŸ”§ Interfaces

```go
// InventoryRepository Ø§ÛŒÙ†ØªØ±ÙÛŒØ³ Ø¯Ø³ØªØ±Ø³ÛŒ Ø¨Ù‡ Ù…ÙˆØ¬ÙˆØ¯ÛŒ
type InventoryRepository interface {
    GetByVariantID(ctx context.Context, variantID int64) (*Inventory, error)
    GetByWarehouseAndVariant(ctx context.Context, warehouseID, variantID int64) (*Inventory, error)
    GetLowStock(ctx context.Context, threshold float64) ([]Inventory, error)
    Create(ctx context.Context, inv *Inventory) error
    Update(ctx context.Context, inv *Inventory) error
    UpdateQuantity(ctx context.Context, variantID int64, qty float64) error
    BulkUpdate(ctx context.Context, updates []InventoryUpdate) error
}

// StockTransactionRepository Ø§ÛŒÙ†ØªØ±ÙÛŒØ³ ØªØ±Ø§Ú©Ù†Ø´â€ŒÙ‡Ø§ÛŒ Ø§Ù†Ø¨Ø§Ø±
type StockTransactionRepository interface {
    Create(ctx context.Context, tx *StockTransaction) error
    GetByVariantID(ctx context.Context, variantID int64, filter TransactionFilter) ([]StockTransaction, error)
    GetBalance(ctx context.Context, variantID int64) (float64, error)
    SumByPeriod(ctx context.Context, variantID int64, from, to time.Time) (float64, error)
}

// ReservationRepository Ø§ÛŒÙ†ØªØ±ÙÛŒØ³ Ø±Ø²Ø±Ùˆ Ù…ÙˆØ¬ÙˆØ¯ÛŒ
type ReservationRepository interface {
    Create(ctx context.Context, res *StockReservation) error
    GetByOrderID(ctx context.Context, orderID int64) ([]StockReservation, error)
    GetPending(ctx context.Context, variantID int64) ([]StockReservation, error)
    GetExpired(ctx context.Context) ([]StockReservation, error)
    UpdateStatus(ctx context.Context, id int64, status int) error
    Release(ctx context.Context, id int64) error
    Confirm(ctx context.Context, id int64) error
}

// StockService Ø§ÛŒÙ†ØªØ±ÙÛŒØ³ Ø³Ø±ÙˆÛŒØ³ Ù…ÙˆØ¬ÙˆØ¯ÛŒ
type StockService interface {
    // Ù…ÙˆØ¬ÙˆØ¯ÛŒ
    GetAvailable(ctx context.Context, variantID int64) (float64, error)
    CheckAvailability(ctx context.Context, variantID int64, qty float64) (bool, error)
    
    // ØªØ±Ø§Ú©Ù†Ø´â€ŒÙ‡Ø§
    AddStock(ctx context.Context, req AddStockRequest) (*StockTransaction, error)
    WithdrawStock(ctx context.Context, req WithdrawRequest) (*StockTransaction, error)
    AdjustStock(ctx context.Context, req AdjustRequest) (*StockTransaction, error)
    
    // Ø±Ø²Ø±Ùˆ
    Reserve(ctx context.Context, req ReserveRequest) (*StockReservation, error)
    Release(ctx context.Context, reservationID int64) error
    Confirm(ctx context.Context, reservationID int64) error
    
    // Ù‡Ù…Ú¯Ø§Ù…â€ŒØ³Ø§Ø²ÛŒ
    SyncWithCatalog(ctx context.Context, variantID int64) error
}
```

---

## ğŸ“‹ Ø¬Ø¯Ø§ÙˆÙ„ Ø¯ÛŒØªØ§Ø¨ÛŒØ³

```sql
-- Ø§Ù†Ø¨Ø§Ø±Ù‡Ø§
CREATE TABLE warehouses (
    id BIGINT UNSIGNED PRIMARY KEY AUTO_INCREMENT,
    name VARCHAR(255) NOT NULL,
    code VARCHAR(50) UNIQUE,
    address TEXT,
    is_default BOOLEAN DEFAULT FALSE,
    is_active BOOLEAN DEFAULT TRUE,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
    deleted_at TIMESTAMP NULL
);

-- ÙˆØ§Ø­Ø¯Ù‡Ø§
CREATE TABLE units (
    id BIGINT UNSIGNED PRIMARY KEY AUTO_INCREMENT,
    name VARCHAR(100) NOT NULL,
    symbol VARCHAR(20),
    type TINYINT DEFAULT 1,
    step_unit DECIMAL(10,4),
    min DECIMAL(10,4),
    sub_unit JSON,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP
);

-- Ù…ÙˆØ¬ÙˆØ¯ÛŒ Ù„Ø­Ø¸Ù‡â€ŒØ§ÛŒ
CREATE TABLE inventories (
    id BIGINT UNSIGNED PRIMARY KEY AUTO_INCREMENT,
    warehouse_id BIGINT UNSIGNED NOT NULL,
    variant_id BIGINT UNSIGNED NOT NULL,
    unit_id BIGINT UNSIGNED,
    
    quantity DECIMAL(15,4) DEFAULT 0,
    reserved_qty DECIMAL(15,4) DEFAULT 0,
    available_qty DECIMAL(15,4) DEFAULT 0,
    
    min_threshold DECIMAL(15,4),
    max_threshold DECIMAL(15,4),
    reorder_point DECIMAL(15,4),
    
    average_cost BIGINT,
    last_cost BIGINT,
    
    version INT DEFAULT 1,
    last_updated TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
    
    FOREIGN KEY (warehouse_id) REFERENCES warehouses(id),
    FOREIGN KEY (variant_id) REFERENCES variants(id),
    UNIQUE KEY unique_warehouse_variant (warehouse_id, variant_id)
);

-- ØªØ±Ø§Ú©Ù†Ø´â€ŒÙ‡Ø§ÛŒ Ø§Ù†Ø¨Ø§Ø±
CREATE TABLE stock_transactions (
    id BIGINT UNSIGNED PRIMARY KEY AUTO_INCREMENT,
    warehouse_id BIGINT UNSIGNED NOT NULL,
    variant_id BIGINT UNSIGNED NOT NULL,
    unit_id BIGINT UNSIGNED,
    
    type VARCHAR(20) NOT NULL,
    amount DECIMAL(15,4) NOT NULL,
    balance DECIMAL(15,4) NOT NULL,
    reserved_amount DECIMAL(15,4) DEFAULT 0,
    
    unit_price BIGINT,
    total_price BIGINT,
    
    order_item_id BIGINT UNSIGNED,
    reference_type VARCHAR(50),
    reference_id BIGINT UNSIGNED,
    
    operator_id BIGINT UNSIGNED NOT NULL,
    vendor_id BIGINT UNSIGNED,
    
    date DATE NOT NULL,
    note TEXT,
    status TINYINT DEFAULT 1,
    
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
    deleted_at TIMESTAMP NULL,
    
    FOREIGN KEY (warehouse_id) REFERENCES warehouses(id),
    FOREIGN KEY (variant_id) REFERENCES variants(id),
    INDEX idx_variant_date (variant_id, date),
    INDEX idx_type_status (type, status)
);

-- Ø±Ø²Ø±ÙˆÙ‡Ø§ÛŒ Ù…ÙˆØ¬ÙˆØ¯ÛŒ
CREATE TABLE stock_reservations (
    id BIGINT UNSIGNED PRIMARY KEY AUTO_INCREMENT,
    warehouse_id BIGINT UNSIGNED NOT NULL,
    variant_id BIGINT UNSIGNED NOT NULL,
    order_id BIGINT UNSIGNED NOT NULL,
    order_item_id BIGINT UNSIGNED NOT NULL,
    
    quantity DECIMAL(15,4) NOT NULL,
    status TINYINT DEFAULT 0,
    
    expires_at TIMESTAMP NOT NULL,
    released_at TIMESTAMP NULL,
    confirmed_at TIMESTAMP NULL,
    
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
    
    FOREIGN KEY (warehouse_id) REFERENCES warehouses(id),
    FOREIGN KEY (variant_id) REFERENCES variants(id),
    INDEX idx_order (order_id),
    INDEX idx_variant_status (variant_id, status),
    INDEX idx_expires (expires_at, status)
);

-- Ù„Ø§Ú¯ ØªØºÛŒÛŒØ±Ø§Øª
CREATE TABLE inventory_logs (
    id BIGINT UNSIGNED PRIMARY KEY AUTO_INCREMENT,
    inventory_id BIGINT UNSIGNED NOT NULL,
    variant_id BIGINT UNSIGNED NOT NULL,
    
    action VARCHAR(20) NOT NULL,
    field VARCHAR(50),
    old_value JSON,
    new_value JSON,
    
    user_id BIGINT UNSIGNED,
    ip_address VARCHAR(45),
    user_agent TEXT,
    
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    
    INDEX idx_inventory (inventory_id),
    INDEX idx_variant (variant_id),
    INDEX idx_created (created_at)
);
```

---

## ğŸ”œ Ù…Ø±Ø§Ø­Ù„ Ù¾ÛŒØ´Ù†Ù‡Ø§Ø¯ÛŒ Ù¾ÛŒØ§Ø¯Ù‡â€ŒØ³Ø§Ø²ÛŒ

1. [ ] ØªØµÙ…ÛŒÙ…â€ŒÚ¯ÛŒØ±ÛŒ: Ù…Ø§Ú˜ÙˆÙ„ Ø¯Ø§Ø®Ù„ÛŒ ÛŒØ§ Ù…Ø§ÛŒÚ©Ø±ÙˆØ³Ø±ÙˆÛŒØ³ Ù…Ø³ØªÙ‚Ù„
2. [ ] Ø§ÛŒØ¬Ø§Ø¯ Ù…Ø¯Ù„â€ŒÙ‡Ø§ÛŒ Ø¯Ø§Ù…ÛŒÙ† Ùˆ Ø¬Ø¯Ø§ÙˆÙ„
3. [ ] Ù¾ÛŒØ§Ø¯Ù‡â€ŒØ³Ø§Ø²ÛŒ Repository Layer
4. [ ] Ù¾ÛŒØ§Ø¯Ù‡â€ŒØ³Ø§Ø²ÛŒ Service Layer
5. [ ] Ù¾ÛŒØ§Ø¯Ù‡â€ŒØ³Ø§Ø²ÛŒ API Handlers
6. [ ] Ø±Ø§Ù‡â€ŒØ§Ù†Ø¯Ø§Ø²ÛŒ Event System
7. [ ] Ù¾ÛŒØ§Ø¯Ù‡â€ŒØ³Ø§Ø²ÛŒ Ù‡Ù…Ú¯Ø§Ù…â€ŒØ³Ø§Ø²ÛŒ Ø¨Ø§ Ú©Ø§ØªØ§Ù„ÙˆÚ¯
8. [ ] ØªØ³Øªâ€ŒÙ‡Ø§ÛŒ Unit Ùˆ Integration
9. [ ] Ù¾ÛŒØ§Ø¯Ù‡â€ŒØ³Ø§Ø²ÛŒ Ù…Ú©Ø§Ù†ÛŒØ²Ù… Ø¬Ù„ÙˆÚ¯ÛŒØ±ÛŒ Ø§Ø² Oversell
10. [ ] Ú¯Ø²Ø§Ø±Ø´Ø§Øª Ùˆ Ø¯Ø§Ø´Ø¨ÙˆØ±Ø¯ Ø§Ù†Ø¨Ø§Ø±

---

## ğŸ“Œ Ø³ÙˆØ§Ù„Ø§Øª Ø¨Ø§Ø² Ø¨Ø±Ø§ÛŒ Ø¨Ø±Ø±Ø³ÛŒ

1. Ø¢ÛŒØ§ Ø§Ù†Ø¨Ø§Ø± Ø¨Ø§ÛŒØ¯ Ù…Ø§ÛŒÚ©Ø±ÙˆØ³Ø±ÙˆÛŒØ³ Ù…Ø³ØªÙ‚Ù„ Ø¨Ø§Ø´Ø¯ ÛŒØ§ Ø¨Ø®Ø´ÛŒ Ø§Ø² Ú©Ø§ØªØ§Ù„ÙˆÚ¯ØŸ
2. Ø¢ÛŒØ§ Ù†ÛŒØ§Ø² Ø¨Ù‡ Ù¾Ø´ØªÛŒØ¨Ø§Ù†ÛŒ Ø§Ø² Ú†Ù†Ø¯ Ø§Ù†Ø¨Ø§Ø± ÙÛŒØ²ÛŒÚ©ÛŒ ÙˆØ¬ÙˆØ¯ Ø¯Ø§Ø±Ø¯ØŸ
3. Ø¢ÛŒØ§ Ø±Ø²Ø±Ùˆ Ù…ÙˆØ¬ÙˆØ¯ÛŒ Ø¨Ø§ÛŒØ¯ Ø²Ù…Ø§Ù† Ø§Ù†Ù‚Ø¶Ø§ Ø¯Ø§Ø´ØªÙ‡ Ø¨Ø§Ø´Ø¯ØŸ
4. Ø§Ø³ØªØ±Ø§ØªÚ˜ÛŒ Ù…Ø­Ø§Ø³Ø¨Ù‡ Ù…ÛŒØ§Ù†Ú¯ÛŒÙ† Ù‚ÛŒÙ…Øª Ø®Ø±ÛŒØ¯ Ú†ÛŒØ³ØªØŸ (FIFO, LIFO, Weighted Average)
5. Ø¢ÛŒØ§ Ù†ÛŒØ§Ø² Ø¨Ù‡ Ù…Ø¯ÛŒØ±ÛŒØª Ø³Ø±ÛŒØ§Ù„ Ù†Ø§Ù…Ø¨Ø± ÛŒØ§ Ø¨Ú† Ù†Ø§Ù…Ø¨Ø± ÙˆØ¬ÙˆØ¯ Ø¯Ø§Ø±Ø¯ØŸ
6. Ø­Ø¯Ø§Ú©Ø«Ø± Ø²Ù…Ø§Ù† Ù‚Ø§Ø¨Ù„ Ù‚Ø¨ÙˆÙ„ Ø¨Ø±Ø§ÛŒ Ù‡Ù…Ú¯Ø§Ù…â€ŒØ³Ø§Ø²ÛŒ Ù…ÙˆØ¬ÙˆØ¯ÛŒ Ú†Ù‚Ø¯Ø± Ø§Ø³ØªØŸ

---

**ØªØ§Ø±ÛŒØ® Ø§ÛŒØ¬Ø§Ø¯:** Û±Û´Û°Û´/Û°Û¹/Û±Û¶  
**Ù†Ø³Ø®Ù‡:** 1.0.0 (Ù¾ÛŒØ´Ù†Ù‡Ø§Ø¯ÛŒ)  
**Ù†ÙˆÛŒØ³Ù†Ø¯Ù‡:** ØªÛŒÙ… ØªÙˆØ³Ø¹Ù‡ Ø±ÙˆÚ†ÛŒ

> âš ï¸ Ø§ÛŒÙ† Ø³Ù†Ø¯ Ù¾ÛŒØ´Ù†Ù‡Ø§Ø¯ÛŒ Ø§Ø³Øª Ùˆ Ù‚Ø¨Ù„ Ø§Ø² Ù¾ÛŒØ§Ø¯Ù‡â€ŒØ³Ø§Ø²ÛŒ Ù†ÛŒØ§Ø² Ø¨Ù‡ Ø¨Ø±Ø±Ø³ÛŒ Ùˆ ØªØ§ÛŒÛŒØ¯ ØªÛŒÙ… ÙÙ†ÛŒ Ø¯Ø§Ø±Ø¯.

